<div class="conversation-list">
  <div class="list-header">
    <h2>Messages</h2>
    <!-- FAB Button -->
    <button
      pButton
      icon="pi pi-plus"
      [rounded]="true"
      class="fab-button"
      aria-label="Start new conversation"
      (click)="showNewChatModal()"
    ></button>
  </div>

  <div class="search-container">
    <app-icon-field
      [value]="searchQuery()"
      (valueChange)="onSearch($event)"
      [placeholder]="'Search conversations or users...'"
      [iconClass]="'pi pi-search'"
      iconPosition="left"
    ></app-icon-field>
  </div>

  @if (searchQuery() && searchResults().length > 0) {
    <div class="search-results">
      <p class="section-title">Search Results</p>
      @for (user of searchResults(); track user.id) {
        <div
          class="search-result-item"
          role="button"
          tabindex="0"
          (click)="onSelectUser(user)"
          (keydown.enter)="onSelectUser(user)"
        >
          <div class="avatar-fallback">
            {{
              (user.displayName || user.username).substring(0, 2) | uppercase
            }}
          </div>
          <div class="user-details">
            <h4>{{ user.displayName || user.username }}</h4>
            <p>{{ user.jobTitle || user.email }}</p>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="conversations-container">
      @if (isLoading()) {
        <div class="loading-state">
          <i class="pi pi-spin pi-spinner"></i>
          <p>Loading conversations...</p>
        </div>
      } @else if (!isLoading() && conversations().length === 0) {
        <div class="empty-state">
          <i class="pi pi-inbox"></i>
          <p>No conversations yet</p>
          <span>Search for users to start chatting</span>
        </div>
      } @else {
        @if (conversations().length > 0) {
          @for (conversation of conversations(); track conversation.id) {
            <app-conversation-item
              [conversation]="conversation"
              [isActive]="conversation.id === activeConversationId()"
              (selected)="onSelectConversation($event)"
            ></app-conversation-item>
          }
        }
      }
    </div>
  }

  <!-- New Chat Modal -->
  <app-new-chat-modal
    #newChatModal
    (userSelected)="onUserSelected($event)"
    (closed)="onModalClosed()"
  ></app-new-chat-modal>
</div>
